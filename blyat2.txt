------НАСТРОЙКА GRE тунель---------

(HQ-R)
nano /etc/network/interfaces
[Добавить]
auto gre1
 iface gre1 inet tunnel
 address 10.10.10.1
 netmask 255.255.255.252
 mode gre
 local 4.4.4.100
 endpoint 5.5.5.100
 ttl 255

systemctl restart networking

(BR-R)
nano /etc/network/interfaces
[Добавить]
auto gre1
  iface gre1 inet tunnel
  address 10.10.10.2
  netmask 255.255.255.252
  mode grenan
  local 5.5.5.10a0
  endpoint 4.4.4.100
  ttl 255

systemctl restart networking


------НАСТРОЙКА Мониторинг средствами rsyslog----------

[HQ-SRV]
apt install rsyslog
cp /etc/rsyslog.conf /etc/rsyslog.conf.bak - Резервная копия

nano /etc/rsyslog.conf
[Откоментить]
	module(load="imudp")
	input(type="imudp" port="514?)

	module(load="imtcp")
	input(type="imtcp" port="514?)
[Добавить в конец файла]
$template remote-incoming-logs,"/var/log/%HOSTNAME%/%PROGRAMNAME%.log"
*.* ?remote-incoming-logs

systemctl restart rsyslog

[Остальные]
nano /etc/rsyslog.conf
[Добавить в конец файла]
*.* @192.168.200.3:514
*.* @@192.168.200.3:514
$ActionQueueFileName queue
$ActionQueueMaxDiskSpace 2g
$ActionQueueSaveOnShutdown on
$ActionQueueType LinkedList
$ActionResumeRetryCount -1

systemctl restart rsyslog


------НАСТРОЙКА SSH Сертификаты---------

ssh-keygen -t rsa

(Везде куда можно подключится)
nano /etc/ssh/sshd_config
[Заменить] PermitRootLogin yes

ssh-copy-id root@192.168.200.3

nano /etc/ssh/sshd_config
[Заменить] PasswordAuthentication no


------НАСТРОЙКА RAID 5 Массив----------

apt install  mdadm

lsblk

fdisk /dev/sdb
n
(Тыкаем энтер)
w
mkfs -t ext4 /dev/sdb1

fdisk /dev/sdc
n
(Тыкаем энтер)
w
mkfs -t ext4 /dev/sdc1
…

mdadm --create /dev/md0 --level=5 --raid-devices=3 /dev/sdc /dev/sdb /dev/sdd

cat /proc/mdstat

mkfs -t ext4 /dev/md0
mkdir /mnt/md
mount /dev/md0 /mnt/md

echo "/dev/md0 /mnt/md ext4 defaults 0 0" >> /etc/fstab

systemctl daemon-reload
lsblk


------НАСТРОЙКА FRR---------

Скрипт
HQ-R
nano /frr
#!/bin/bash
echo conf t > tmp.l
echo router ospf vrf default >> tmp.l
echo network 192.168.200.0/26 area 0 >> tmp.l
echo network 4.4.4.0/24 area 0 >> tmp.l

cat tmp.l | vtysh

ISP
#!/bin/bash
echo conf t > tmp.l
echo router ospf vrf default >> tmp.l
echo network 3.3.3.0/24 area 0 >> tmp.l
echo network 4.4.4.0/24 area 0 >> tmp.l
echo network 5.5.5.0/24 area 0 >> tmp.l

cat tmp.l | vtysh

BR-R
#!/bin/bash
echo conf t > tmp.l
echo router ospf vrf default >> tmp.l
echo network 172.16.100.1/28 area 0 >> tmp.l
echo network 5.5.5.0/24 area 0 >> tmp.l

cat tmp.l | vtysh

-----Микросрань-----

nano /etc/sysctl.conf
[Заменить/Вставить] net.ipv4.ip_forward = 1

--СРАНЬ ПОЛНАЯ--
apt install sysstat

#!/bin/bash

CPU_LOAD=$(sar -u 1 1 | grep 'Average:' | awk '{print 100 - $NF}')

if (( $(echo "$CPU_LOAD >= 70" | bc -l) )); then
    echo "CPU load is above 70%: $CPU_LOAD%"
    # Здесь вы можете добавить действия для оповещения пользователя или администратора
fi

apt install cron

nano /etc/crontab

* * * * * root /путь/к/вашему/скрипту/мониторинга.sh

#!/bin/bash

# Получаем информацию об оперативной памяти и извлекаем процент использования
MEMORY_USAGE=$(free | grep Mem | awk '{printf "%.2f", $3/$2 * 100}')

# Устанавливаем порог заполненности оперативной памяти
THRESHOLD=80.0

# Проверяем, превышает ли использование оперативной памяти установленный порог
if (( $(echo "$MEMORY_USAGE >= $THRESHOLD" | bc -l) )); then
    echo "Memory usage is above $THRESHOLD%: $MEMORY_USAGE%"
    # Здесь вы можете добавить действия для оповещения пользователя или администратора
fi
